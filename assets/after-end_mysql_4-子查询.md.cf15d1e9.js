import{_ as s,o as n,c as a,V as o}from"./chunks/framework.f4d827d1.js";const F=JSON.parse('{"title":"","description":"","frontmatter":{},"headers":[],"relativePath":"after-end/mysql/4-子查询.md","filePath":"after-end/mysql/4-子查询.md","lastUpdated":1691125473000}'),l={name:"after-end/mysql/4-子查询.md"},p=o(`<div class="language-SQL"><button title="Copy Code" class="copy"></button><span class="lang">SQL</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#F78C6C;">select</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">name</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">from</span><span style="color:#A6ACCD;"> department</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F78C6C;">where</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">exists</span><span style="color:#A6ACCD;"> (</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#F78C6C;">select</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">*</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">from</span><span style="color:#A6ACCD;"> employee </span><span style="color:#F78C6C;">where</span><span style="color:#A6ACCD;"> department.id </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> employee.department_id</span></span>
<span class="line"><span style="color:#A6ACCD;">    );</span></span></code></pre></div><div class="language-SQL"><button title="Copy Code" class="copy"></button><span class="lang">SQL</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#F78C6C;">create</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">database</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">practice</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#F78C6C;">use</span><span style="color:#A6ACCD;"> practice</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F78C6C;">select</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">*</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">from</span><span style="color:#A6ACCD;"> customers</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F78C6C;">select</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">*</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">from</span><span style="color:#A6ACCD;"> orders</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F78C6C;">select</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">*</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">from</span><span style="color:#A6ACCD;"> order_items</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F78C6C;">select</span><span style="color:#A6ACCD;"> customers.name, </span><span style="color:#82AAFF;">sum</span><span style="color:#A6ACCD;">(orders.total_amount) </span><span style="color:#F78C6C;">as</span><span style="color:#A6ACCD;"> total_amount</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F78C6C;">from</span><span style="color:#A6ACCD;"> customers</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F78C6C;">inner join</span><span style="color:#A6ACCD;"> orders </span><span style="color:#F78C6C;">on</span><span style="color:#A6ACCD;"> customers.id </span><span style="color:#89DDFF;">===</span><span style="color:#A6ACCD;"> orders.customer_id</span></span>
<span class="line"><span style="color:#A6ACCD;">  group_by customers.id;</span></span>
<span class="line"><span style="color:#A6ACCD;">  order_by total_aoumt </span><span style="color:#F78C6C;">desc</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F78C6C;">limit</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">0</span><span style="color:#A6ACCD;">,</span><span style="color:#F78C6C;">3</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F78C6C;">select</span><span style="color:#A6ACCD;"> customers.name, </span><span style="color:#82AAFF;">sum</span><span style="color:#A6ACCD;">(orders.total_amount) </span><span style="color:#F78C6C;">as</span><span style="color:#A6ACCD;"> total_amount,</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#82AAFF;">sum</span><span style="color:#A6ACCD;">(orders.total_amount) </span><span style="color:#89DDFF;">/</span><span style="color:#A6ACCD;"> (</span><span style="color:#F78C6C;">select</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">sum</span><span style="color:#A6ACCD;">(total_amount) </span><span style="color:#F78C6C;">from</span><span style="color:#A6ACCD;"> orders) </span><span style="color:#F78C6C;">as</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">percentage</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F78C6C;">from</span><span style="color:#A6ACCD;"> customers</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F78C6C;">inner join</span><span style="color:#A6ACCD;"> orders </span><span style="color:#F78C6C;">on</span><span style="color:#A6ACCD;"> customers.id </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> orders.customer_id</span></span>
<span class="line"><span style="color:#A6ACCD;">  group_by customers.id</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F78C6C;">select</span><span style="color:#A6ACCD;"> customers.name, orders.order_order_date, orders.total_amount, order_items.product_name, order_items.quantity, order_items.price</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F78C6C;">from</span><span style="color:#A6ACCD;"> customers</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F78C6C;">join</span><span style="color:#A6ACCD;"> orders </span><span style="color:#F78C6C;">on</span><span style="color:#A6ACCD;"> customers.id </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> orders.customer_id</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F78C6C;">join</span><span style="color:#A6ACCD;"> order_items om orders_customer_id </span><span style="color:#89DDFF;">===</span><span style="color:#A6ACCD;"> order_items.order_id</span></span>
<span class="line"><span style="color:#A6ACCD;">  order_by customers.name, orders.order_date</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F78C6C;">select</span><span style="color:#A6ACCD;"> customers.name, orders.order_order_date, orders.total_amount, order_items.product_name, order_items.quantity, order_items.price</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F78C6C;">from</span><span style="color:#A6ACCD;"> customers</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F78C6C;">join</span><span style="color:#A6ACCD;"> orders </span><span style="color:#F78C6C;">on</span><span style="color:#A6ACCD;"> customers.id </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> orders.customer_id</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F78C6C;">join</span><span style="color:#A6ACCD;"> order_items om orders_customer_id </span><span style="color:#89DDFF;">===</span><span style="color:#A6ACCD;"> order_items.order_id</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F78C6C;">where</span><span style="color:#A6ACCD;"> customers.name </span><span style="color:#F78C6C;">like</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">张%</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"><span style="color:#A6ACCD;">  order_by customers.name, orders.order_date</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F78C6C;">select</span><span style="color:#A6ACCD;"> customers.name, orders.order_order_date, orders.total_amount, order_items.product_name, order_items.quantity, order_items.price</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F78C6C;">from</span><span style="color:#A6ACCD;"> customers</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F78C6C;">join</span><span style="color:#A6ACCD;"> orders </span><span style="color:#F78C6C;">on</span><span style="color:#A6ACCD;"> customers.id </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> orders.customer_id</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F78C6C;">join</span><span style="color:#A6ACCD;"> order_items om orders_customer_id </span><span style="color:#89DDFF;">===</span><span style="color:#A6ACCD;"> order_items.order_id</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F78C6C;">where</span><span style="color:#A6ACCD;"> orders.order_date </span><span style="color:#F78C6C;">between</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">2022-01-01</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">and</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">2022-01-03</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"><span style="color:#A6ACCD;">  order_by customers.name, orders.order_date</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F78C6C;">SELECT</span></span>
<span class="line"><span style="color:#A6ACCD;">        c.name </span><span style="color:#F78C6C;">AS</span><span style="color:#A6ACCD;"> customer_name,</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#82AAFF;">SUM</span><span style="color:#A6ACCD;">(o.total_amount) </span><span style="color:#F78C6C;">AS</span><span style="color:#A6ACCD;"> total_amount,</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#82AAFF;">COUNT</span><span style="color:#A6ACCD;">(oi.id) </span><span style="color:#F78C6C;">AS</span><span style="color:#A6ACCD;"> total_quantity,</span></span>
<span class="line"><span style="color:#A6ACCD;">        GROUP_CONCAT(oi.product_name SEPARATOR </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">-</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">) </span><span style="color:#F78C6C;">AS</span><span style="color:#A6ACCD;"> product_names</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F78C6C;">FROM</span><span style="color:#A6ACCD;"> customers c</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F78C6C;">JOIN</span><span style="color:#A6ACCD;"> orders o </span><span style="color:#F78C6C;">ON</span><span style="color:#A6ACCD;"> c.id </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> o.customer_id</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F78C6C;">JOIN</span><span style="color:#A6ACCD;"> order_items oi </span><span style="color:#F78C6C;">ON</span><span style="color:#A6ACCD;"> o.id </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> oi.order_id</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F78C6C;">WHERE</span><span style="color:#A6ACCD;"> oi.product_name </span><span style="color:#F78C6C;">LIKE</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">%鞋%</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F78C6C;">GROUP BY</span><span style="color:#A6ACCD;"> c.name</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F78C6C;">ORDER BY</span><span style="color:#A6ACCD;"> total_amount </span><span style="color:#F78C6C;">DESC</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F78C6C;">LIMIT</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">3</span><span style="color:#A6ACCD;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F78C6C;">select</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">*</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">from</span><span style="color:#A6ACCD;"> customers c</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F78C6C;">where</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">exists</span><span style="color:#A6ACCD;">(</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F78C6C;">select</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">1</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">from</span><span style="color:#A6ACCD;"> orders o </span><span style="color:#F78C6C;">where</span><span style="color:#A6ACCD;"> o.customer_id </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> id</span></span>
<span class="line"><span style="color:#A6ACCD;">  );</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F78C6C;">update</span><span style="color:#A6ACCD;"> orders o </span><span style="color:#F78C6C;">set</span><span style="color:#A6ACCD;"> o.total_amount </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> o.total_amount </span><span style="color:#89DDFF;">*</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">0</span><span style="color:#A6ACCD;">.</span><span style="color:#F78C6C;">9</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F78C6C;">where</span><span style="color:#A6ACCD;"> o.customer_id </span><span style="color:#F78C6C;">in</span><span style="color:#A6ACCD;"> (</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F78C6C;">select</span><span style="color:#A6ACCD;"> id </span><span style="color:#F78C6C;">from</span><span style="color:#A6ACCD;"> customers </span><span style="color:#F78C6C;">where</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">name</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">王磊</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"><span style="color:#A6ACCD;">  );</span></span></code></pre></div>`,2),e=[p];function r(C,t,c,A,y,D){return n(),a("div",null,e)}const d=s(l,[["render",r]]);export{F as __pageData,d as default};
